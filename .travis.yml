dist: trusty
sudo: false
language: node_js
node_js:
- '9'
os:
- linux
cache: yarn

env:
  global: 
    - # Environment variables for NPM version patch    
    - secure: "CMw+ysios212nV+kCQB2oClJx+m/SHSI+qPrMcRkeZ8LYeBoWhtPN1UQvTnN/vLHX/mpa4hUqd3Q9lMWdpBZDlMvGX0CZ8waVNyKx1iGBHiY2YViICx+aXAAQ8+Zxmfn/lzKhqH7QJu14UDXSOUkoPKL4UfXHYAQsen/svC9BYTTQEopmF60DAAjlLY/6Vb+rn6DhcxC/GWlkQyr8P4JFLsJKyg/Kc78vki+ficvuJ6Y1PmlqGkV/uYCVAlUVdS+pgznyNvYijjAA3Zy8OxnzrZ1kOoK4eW4j5k39dVXXZWqiF/q21ReoaNhby0tRFpdDU0aQqrBR1pZSfIMA6kl+y285k37id1fyHGvjbsfQDvEvpYFwIr/w2mmHBgauzbQ8VJ9ZWDElh4+NbrfR5znm0pyzzeH8HPdLSwb95dh+AlsUX2ef7V8V/7gd8bIkoFFnJ473Z+Tju15woVvSueaghVeQE8/cVRUvV67zvd691z+ulV15WdXktZGNMR5CJTRZ/s0LoZOYjyyKphIHiMXfNaWJmUI/Nf67O/vERowxIifobvFl23PO1UWqwP76gtrfTwcPL29SMStiuIQNZHT0X5AyCOLfaAEoNYnmSsO2aqkWlB7vGsi6lRX2F+egAxcyLTTaVmFI8X43+v576epg0JAo3lL/wYSDisSMu+FHsE="
    - secure: "HxppQ6nqVXhXiSnuDRIyA0R9H1uDIbxeAhhl2FIH1mn4/VEmBuzWZdR4XUrO4lh9LJPrUR5xZu5yxKJS/Plfd6BIvsa+yKQpUJTJjLx4dk3vVHRcRvgpJGijEby/N/Rogtxa0fEuIx7L4dGEwxR7HZ5s2nwu9DKDFXHjPTq9cxYo2GsA4jMl/rd7tBkIfETxb1t0N0B9iaW5+FJ3qZTkchgfAcpdeaSCH5kD2eZ5v0qsr3E+qH8xVjcObzaeQjrbwN3hCIAJT7qLE4TkwPD0gdvj0cYrwv9hGrliQ5HURP2P7gpqpZLQTragaM17L0Lz3caxIjeQPbECKOqhefUpumhp0l8r3lW5ig3nsoq0S5OO1sjqIRdjncsg6RrOPNkfBPmm/xtTmIN9hoXP5L8mmNs/k1o1AG5sX4JAL4TcM7k4iypWdPeVFv+tQUhSKnSBQ2ObpfdXaSlhRgOg7pe4iZdqtKU3WE7xmtLMxdoBi42RPUy5CESYbKgU5ILy102Q6bEgOYVjy8ZvO/02MHYsL3nzCCX3LlrSBC1EMOsIsepLnODCOWK9AScI7GTEHtx28qfXq/15lNSziBxDKHwZKxnqs5u3rXgyJRGju/iGAp/GJMgSfXaqb6IKP05mTjuNXLForG0JAbOvneiOGSA3MFBLbAF0w8p/P5PAV/fha6A=" 

  matrix:
    - FIREFOX_VERSION="latest"
    - FIREFOX_VERSION="61.0.2"

before_install:
- echo $FIREFOX_VERSION
- export FIREFOX_SOURCE_URL='https://download.mozilla.org/?product=firefox-'$FIREFOX_VERSION'&lang=en-US&os=linux64'
- wget --no-verbose -O /tmp/firefox-$FIREFOX_VERSION.tar.bz2 $FIREFOX_SOURCE_URL
- mkdir /tmp/firefox-$FIREFOX_VERSION
- tar -xvf /tmp/firefox-$FIREFOX_VERSION.tar.bz2 -C /tmp/firefox-$FIREFOX_VERSION
- export PATH=/tmp/firefox-$FIREFOX_VERSION/firefox:$PATH
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- export CHROME_BIN=/usr/bin/google-chrome
- curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.6.0
- export PATH="$HOME/.yarn/bin:$PATH"
- sudo apt-get update
- sudo apt-get install -y libappindicator1 fonts-liberation google-chrome-stable
install:
- yarn install
script:
- firefox --version
- npm run lint
- npm run test:once
- npm run e2e
after_success:
- npm run packagr
# Autoincrement of patch level version:
# Tag the repo with a new patch level version tag, if this build is done on
#     'FIREFOX_VERSION = latest' and (only one of the matrix-builds is relevant)
#     this is not a pull request and (pull requests themselves should not autoincrement)
#     this branch is the master branch and (only builds on master are relevant)
#     there is no tag given (if a tag is alread given, this one will be published and should not again be tagged!)
- 'if [ "$FIREFOX_VERSION" = "latest" -a "$TRAVIS_PULL_REQUEST" = "false" -a "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_TAG" = "" ]; then wget https://github.com/test-editor/commons-build-automation/raw/master/travis/deploy/tag_with_new_patch_version.sh; bash tag_with_new_patch_version.sh; fi'
before_deploy:
- touch .npmignore
- cd dist/
deploy:
  skip_cleanup: true
  provider: npm
  email: service.eng@akquinet.de
  api_key:
    secure: "sfAhZgj8wDuBVtD5Ly7lBgcs5k7j2jGYWYVmjURZBwBHdFzwvqT/L0HWoq0w+GyljuJu47uXlDOhsQEGmyJnS58NofoAI9qBfUwuJwIdQmfulsLXyvyof+JPbF87bequrEVsUSujWHwaLaSjHgFGHgkj3B3XcoR0uLhQDPGZqNFsDbL8FH5tjyr6LDLjCm675+wVqBynvC+nR5K4XTLNRq8oWOrFAanayc41yBTTq6xhra1+2XWu1N5tiLweERARA7WjrgbX7FshPROlpAsIuvmaVbdaIhuEn6aBzfQni74EMPf4TXLqCCD+i+nZyq9A6DEqQHN418mMxwVOHISMJzYvRAY5Bvz+4RlMRy5vjyE03KR26J8yDNlA2GGwTyXxvSmzBz3TK8RkrkJF5hNadI768rf2mS+2Iyhj3CHIbBJnMyKjeYlZ8Qae9AvDFwNX73dAdOIjyoAUGDCsuVqTFXaL0MLPNQmZg0oR6wcRBmqz43njhiUheq5NFecBrmTIBKB+8VN6OUqCzekMXU6E4oOZbjxPXYvqeyssz6iIQNKW+bMHqwkJVtq1CFdXvkb2RhHz4KY35FONix4axsxRpr53X1+C32iK11joNy6NDvn/u4KvTuQoCQqNLYNWCIiUss6Wtj4uf5y6V3dejfW/Vv9qXIokPZ6u4kACGGjUO+U="
  on:
    condition: "$FIREFOX_VERSION = latest"
    tags: true
    repo: test-editor/web-testeditor-commons
